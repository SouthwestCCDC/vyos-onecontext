# NAT with firewall test context
# Tests combined functionality of NAT + firewall zones
#
# This validates:
# - Source NAT (masquerade) for LAN to WAN
# - Firewall zones (WAN and LAN)
# - Firewall policies allowing LAN->WAN traffic
# - Integration of NAT and firewall (NAT happens before firewall)
#
# Scenario: Router with WAN interface and LAN alias
# - WAN (eth0): 192.168.122.70/24
# - LAN (eth0 alias): 10.200.0.1/24
# - NAT: masquerade 10.200.0.0/24 to WAN
# - Firewall: allow LAN->WAN, drop WAN->LAN (except established/related)

HOSTNAME="test-nat-firewall"
SSH_PUBLIC_KEY="ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIC+Z0iQ4AaHmgc9OWxSBKJnkXtOa57N0AVMv8cJYWi+F test@integration"
ONECONTEXT_MODE="stateless"

# WAN interface
ETH0_IP="192.168.122.70"
ETH0_MASK="255.255.255.0"
ETH0_GATEWAY="192.168.122.1"

# LAN interface (alias - simulates internal network in QEMU single-NIC setup)
ETH0_ALIAS0_IP="10.200.0.1"
ETH0_ALIAS0_MASK="255.255.255.0"

# NAT - masquerade LAN to WAN
NAT_JSON='{"source":[{"outbound_interface":"eth0","source_address":"10.200.0.0/24","translation":"masquerade"}]}'

# Firewall zones and policies
# WAN zone: eth0, default drop
# LAN zone: also eth0 (same physical interface, different subnets), default drop
# Policy: LAN->WAN accept (outbound)
# Note: Zone default_action must be "drop" or "reject" (cannot be "accept" for security)
# Global state policies (established/related) are automatically configured
FIREWALL_JSON='{"zones":{"WAN":{"name":"WAN","interfaces":["eth0"],"default_action":"drop"},"LAN":{"name":"LAN","interfaces":["eth0"],"default_action":"drop"}},"policies":[{"from":"LAN","to":"WAN","rules":[{"action":"accept","description":"Allow outbound from LAN"}]}]}'
